<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠå¤©è®°å½•æœç´¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .search-container {
            padding: 40px;
            background: #f8f9fa;
        }

        .search-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .search-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .search-button:active {
            transform: translateY(0);
        }

        .stats {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4facfe;
        }

        .results-container {
            padding: 0 40px 40px;
        }

        .result-item {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .result-item:hover {
            border-left-color: #4facfe;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .result-date {
            font-weight: bold;
            color: #4facfe;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .result-sender {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .result-content {
            color: #333;
            line-height: 1.6;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        .pagination button {
            padding: 8px 16px;
            border: 1px solid #e1e5e9;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .pagination button:hover {
            background: #4facfe;
            color: white;
        }

        .pagination button.active {
            background: #4facfe;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }

        .debug-info {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” èŠå¤©è®°å½•æœç´¢</h1>
            <p>æœç´¢æ‚¨ä¸ç”Ÿç”Ÿçš„èŠå¤©è®°å½•</p>
        </div>

        <div class="search-container">
            <div class="search-form">
                <div class="form-group">
                    <label for="searchInput">æœç´¢å…³é”®è¯</label>
                    <input type="text" id="searchInput" placeholder="è¾“å…¥è¦æœç´¢çš„å†…å®¹...">
                </div>

                <div class="filter-group">
                    <div class="form-group">
                        <label for="senderFilter">å‘é€è€…</label>
                        <select id="senderFilter">
                            <option value="">å…¨éƒ¨</option>
                            <option value="æ˜Ÿå¦‚é›¨">æ˜Ÿå¦‚é›¨</option>
                            <option value="ç”Ÿç”Ÿ">ç”Ÿç”Ÿ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="mediaFilter">åª’ä½“ç±»å‹</label>
                        <select id="mediaFilter">
                            <option value="">å…¨éƒ¨</option>
                            <option value="text">çº¯æ–‡æœ¬</option>
                            <option value="image">å›¾ç‰‡</option>
                            <option value="emoji">è¡¨æƒ…</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="dateFrom">å¼€å§‹æ—¥æœŸ</label>
                        <input type="date" id="dateFrom">
                    </div>

                    <div class="form-group">
                        <label for="dateTo">ç»“æŸæ—¥æœŸ</label>
                        <input type="date" id="dateTo">
                    </div>
                </div>

                <button class="search-button" onclick="performSearch()">ğŸ” æœç´¢</button>
            </div>

            <div class="stats" id="stats">
                <div>ğŸ“Š æœç´¢ç»Ÿè®¡</div>
                <div id="statsContent">å‡†å¤‡æœç´¢...</div>
            </div>
        </div>

        <div class="results-container">
            <div id="loading" class="loading hidden">æ­£åœ¨æœç´¢ä¸­...</div>
            <div id="results"></div>
            <div id="pagination" class="pagination"></div>
        </div>

        <div class="debug-info hidden" id="debugInfo"></div>
    </div>

    <!-- éšè—çš„iframeç”¨äºåŠ è½½æ–‡ä»¶ -->
    <iframe id="loadFrame" class="hidden"></iframe>

    <script>
        // å…¨å±€å˜é‡
        let allFiles = [];
        let fileCache = new Map();
        let searchResults = [];
        let currentPage = 1;
        const resultsPerPage = 20;

        // åˆå§‹åŒ–æ–‡ä»¶åˆ—è¡¨
        function initializeFileList() {
            allFiles = [
                { url: 'Data/chat_2022_09_24.html', date: '2022-09-24' },
                { url: 'Data/chat_2022_10_01.html', date: '2022-10-01' },
                { url: 'Data/chat_2022_10_02.html', date: '2022-10-02' },
                { url: 'Data/chat_2022_10_05.html', date: '2022-10-05' },
                { url: 'Data/chat_2022_10_06.html', date: '2022-10-06' },
                { url: 'Data/chat_2022_10_07.html', date: '2022-10-07' },
                { url: 'Data/chat_2022_10_09.html', date: '2022-10-09' },
                { url: 'Data/chat_2022_10_10.html', date: '2022-10-10' },
                { url: 'Data/chat_2022_10_11.html', date: '2022-10-11' },
                { url: 'Data/chat_2022_10_14.html', date: '2022-10-14' },
                { url: 'Data/chat_2022_10_15.html', date: '2022-10-15' },
                { url: 'Data/chat_2022_10_16.html', date: '2022-10-16' },
                { url: 'Data/chat_2022_10_20.html', date: '2022-10-20' },
                { url: 'Data/chat_2022_10_21.html', date: '2022-10-21' },
                { url: 'Data/chat_2022_10_22.html', date: '2022-10-22' },
                { url: 'Data/chat_2022_10_23.html', date: '2022-10-23' },
                { url: 'Data/chat_2022_10_26.html', date: '2022-10-26' },
                { url: 'Data/chat_2022_10_28.html', date: '2022-10-28' },
                { url: 'Data/chat_2022_10_29.html', date: '2022-10-29' },
                { url: 'Data/chat_2022_10_30.html', date: '2022-10-30' },
                { url: 'Data/chat_2022_10_31.html', date: '2022-10-31' },
                { url: 'Data/chat_2022_11_01.html', date: '2022-11-01' },
                { url: 'Data/chat_2022_11_02.html', date: '2022-11-02' },
                { url: 'Data/chat_2022_11_03.html', date: '2022-11-03' },
                { url: 'Data/chat_2022_11_04.html', date: '2022-11-04' },
                { url: 'Data/chat_2022_11_05.html', date: '2022-11-05' },
                { url: 'Data/chat_2022_11_06.html', date: '2022-11-06' },
                { url: 'Data/chat_2022_11_07.html', date: '2022-11-07' },
                { url: 'Data/chat_2022_11_09.html', date: '2022-11-09' },
                { url: 'Data/chat_2022_11_10.html', date: '2022-11-10' },
                { url: 'Data/chat_2022_11_11.html', date: '2022-11-11' },
                { url: 'Data/chat_2022_11_12.html', date: '2022-11-12' },
                { url: 'Data/chat_2022_11_13.html', date: '2022-11-13' },
                { url: 'Data/chat_2022_11_14.html', date: '2022-11-14' },
                { url: 'Data/chat_2022_11_15.html', date: '2022-11-15' },
                { url: 'Data/chat_2022_11_16.html', date: '2022-11-16' },
                { url: 'Data/chat_2022_11_17.html', date: '2022-11-17' },
                { url: 'Data/chat_2022_11_18.html', date: '2022-11-18' },
                { url: 'Data/chat_2022_11_19.html', date: '2022-11-19' },
                { url: 'Data/chat_2022_11_20.html', date: '2022-11-20' },
                { url: 'Data/chat_2022_11_21.html', date: '2022-11-21' },
                { url: 'Data/chat_2022_11_22.html', date: '2022-11-22' },
                { url: 'Data/chat_2022_11_23.html', date: '2022-11-23' },
                { url: 'Data/chat_2022_11_24.html', date: '2022-11-24' },
                { url: 'Data/chat_2022_11_25.html', date: '2022-11-25' },
                { url: 'Data/chat_2022_11_26.html', date: '2022-11-26' },
                { url: 'Data/chat_2022_11_27.html', date: '2022-11-27' },
                { url: 'Data/chat_2022_11_28.html', date: '2022-11-28' },
                { url: 'Data/chat_2022_11_29.html', date: '2022-11-29' },
                { url: 'Data/chat_2022_11_30.html', date: '2022-11-30' },
                { url: 'Data/chat_2022_12_02.html', date: '2022-12-02' },
                { url: 'Data/chat_2022_12_03.html', date: '2022-12-03' },
                { url: 'Data/chat_2022_12_10.html', date: '2022-12-10' },
                { url: 'Data/chat_2022_12_12.html', date: '2022-12-12' },
                { url: 'Data/chat_2022_12_20.html', date: '2022-12-20' },
                { url: 'Data/chat_2022_12_28.html', date: '2022-12-28' },
                { url: 'Data/chat_2022_12_29.html', date: '2022-12-29' },
                { url: 'Data/chat_2022_12_30.html', date: '2022-12-30' },
                { url: 'Data/chat_2022_12_31.html', date: '2022-12-31' },
                { url: 'Data/chat_2023_01_01.html', date: '2023-01-01' },
                { url: 'Data/chat_2023_01_02.html', date: '2023-01-02' },
                { url: 'Data/chat_2023_01_03.html', date: '2023-01-03' },
                { url: 'Data/chat_2023_01_04.html', date: '2023-01-04' },
                { url: 'Data/chat_2023_01_05.html', date: '2023-01-05' },
                { url: 'Data/chat_2023_01_06.html', date: '2023-01-06' },
                { url: 'Data/chat_2023_01_07.html', date: '2023-01-07' },
                { url: 'Data/chat_2023_01_08.html', date: '2023-01-08' },
                { url: 'Data/chat_2023_01_09.html', date: '2023-01-09' },
                { url: 'Data/chat_2023_01_10.html', date: '2023-01-10' },
                { url: 'Data/chat_2023_01_11.html', date: '2023-01-11' },
                { url: 'Data/chat_2023_01_12.html', date: '2023-01-12' },
                { url: 'Data/chat_2023_01_13.html', date: '2023-01-13' },
                { url: 'Data/chat_2023_01_14.html', date: '2023-01-14' },
                { url: 'Data/chat_2023_01_15.html', date: '2023-01-15' },
                { url: 'Data/chat_2023_01_16.html', date: '2023-01-16' },
                { url: 'Data/chat_2023_01_17.html', date: '2023-01-17' },
                { url: 'Data/chat_2023_01_18.html', date: '2023-01-18' },
                { url: 'Data/chat_2023_01_19.html', date: '2023-01-19' },
                { url: 'Data/chat_2023_01_20.html', date: '2023-01-20' },
                { url: 'Data/chat_2023_01_21.html', date: '2023-01-21' },
                { url: 'Data/chat_2023_01_22.html', date: '2023-01-22' },
                { url: 'Data/chat_2023_01_23.html', date: '2023-01-23' },
                { url: 'Data/chat_2023_01_24.html', date: '2023-01-24' },
                { url: 'Data/chat_2023_01_25.html', date: '2023-01-25' },
                { url: 'Data/chat_2023_01_26.html', date: '2023-01-26' },
                { url: 'Data/chat_2023_01_27.html', date: '2023-01-27' },
                { url: 'Data/chat_2023_01_28.html', date: '2023-01-28' },
                { url: 'Data/chat_2023_01_29.html', date: '2023-01-29' },
                { url: 'Data/chat_2023_01_30.html', date: '2023-01-30' },
                { url: 'Data/chat_2023_01_31.html', date: '2023-01-31' },
                { url: 'Data/chat_2023_02_01.html', date: '2023-02-01' },
                { url: 'Data/chat_2023_02_02.html', date: '2023-02-02' },
                { url: 'Data/chat_2023_02_03.html', date: '2023-02-03' },
                { url: 'Data/chat_2023_02_04.html', date: '2023-02-04' },
                { url: 'Data/chat_2023_02_05.html', date: '2023-02-05' },
                { url: 'Data/chat_2023_02_06.html', date: '2023-02-06' },
                { url: 'Data/chat_2023_02_07.html', date: '2023-02-07' },
                { url: 'Data/chat_2023_02_08.html', date: '2023-02-08' },
                { url: 'Data/chat_2023_02_09.html', date: '2023-02-09' },
                { url: 'Data/chat_2023_02_10.html', date: '2023-02-10' },
                { url: 'Data/chat_2023_02_11.html', date: '2023-02-11' },
                { url: 'Data/chat_2023_02_12.html', date: '2023-02-12' },
                { url: 'Data/chat_2023_02_13.html', date: '2023-02-13' },
                { url: 'Data/chat_2023_02_14.html', date: '2023-02-14' },
                { url: 'Data/chat_2023_02_16.html', date: '2023-02-16' },
                { url: 'Data/chat_2023_02_17.html', date: '2023-02-17' },
                { url: 'Data/chat_2023_02_18.html', date: '2023-02-18' },
                { url: 'Data/chat_2023_02_19.html', date: '2023-02-19' },
                { url: 'Data/chat_2023_02_20.html', date: '2023-02-20' },
                { url: 'Data/chat_2023_02_21.html', date: '2023-02-21' },
                { url: 'Data/chat_2023_02_22.html', date: '2023-02-22' },
                { url: 'Data/chat_2023_02_23.html', date: '2023-02-23' },
                { url: 'Data/chat_2023_02_24.html', date: '2023-02-24' },
                { url: 'Data/chat_2023_02_25.html', date: '2023-02-25' },
                { url: 'Data/chat_2023_02_26.html', date: '2023-02-26' },
                { url: 'Data/chat_2023_02_27.html', date: '2023-02-27' },
                { url: 'Data/chat_2023_02_28.html', date: '2023-02-28' },
                { url: 'Data/chat_2023_03_01.html', date: '2023-03-01' },
                { url: 'Data/chat_2023_03_02.html', date: '2023-03-02' },
                { url: 'Data/chat_2023_03_03.html', date: '2023-03-03' },
                { url: 'Data/chat_2023_03_04.html', date: '2023-03-04' },
                { url: 'Data/chat_2023_03_05.html', date: '2023-03-05' },
                { url: 'Data/chat_2023_03_06.html', date: '2023-03-06' },
                { url: 'Data/chat_2023_03_07.html', date: '2023-03-07' },
                { url: 'Data/chat_2023_03_08.html', date: '2023-03-08' },
                { url: 'Data/chat_2023_03_09.html', date: '2023-03-09' },
                { url: 'Data/chat_2023_03_10.html', date: '2023-03-10' },
                { url: 'Data/chat_2023_03_11.html', date: '2023-03-11' },
                { url: 'Data/chat_2023_03_12.html', date: '2023-03-12' },
                { url: 'Data/chat_2023_03_13.html', date: '2023-03-13' },
                { url: 'Data/chat_2023_03_14.html', date: '2023-03-14' },
                { url: 'Data/chat_2023_03_15.html', date: '2023-03-15' },
                { url: 'Data/chat_2023_03_16.html', date: '2023-03-16' },
                { url: 'Data/chat_2023_03_17.html', date: '2023-03-17' },
                { url: 'Data/chat_2023_03_18.html', date: '2023-03-18' },
                { url: 'Data/chat_2023_03_19.html', date: '2023-03-19' },
                { url: 'Data/chat_2023_03_20.html', date: '2023-03-20' },
                { url: 'Data/chat_2023_03_21.html', date: '2023-03-21' },
                { url: 'Data/chat_2023_03_22.html', date: '2023-03-22' },
                { url: 'Data/chat_2023_03_23.html', date: '2023-03-23' },
                { url: 'Data/chat_2023_03_24.html', date: '2023-03-24' },
                { url: 'Data/chat_2023_03_25.html', date: '2023-03-25' },
                { url: 'Data/chat_2023_03_26.html', date: '2023-03-26' },
                { url: 'Data/chat_2023_03_27.html', date: '2023-03-27' },
                { url: 'Data/chat_2023_03_28.html', date: '2023-03-28' },
                { url: 'Data/chat_2023_03_29.html', date: '2023-03-29' },
                { url: 'Data/chat_2023_03_30.html', date: '2023-03-30' },
                { url: 'Data/chat_2023_03_31.html', date: '2023-03-31' },
                { url: 'Data/chat_2023_04_01.html', date: '2023-04-01' },
                { url: 'Data/chat_2023_04_02.html', date: '2023-04-02' },
                { url: 'Data/chat_2023_04_03.html', date: '2023-04-03' },
                { url: 'Data/chat_2023_04_04.html', date: '2023-04-04' },
                { url: 'Data/chat_2023_04_05.html', date: '2023-04-05' },
                { url: 'Data/chat_2023_04_06.html', date: '2023-04-06' },
                { url: 'Data/chat_2023_04_07.html', date: '2023-04-07' },
                { url: 'Data/chat_2023_04_08.html', date: '2023-04-08' },
                { url: 'Data/chat_2023_04_09.html', date: '2023-04-09' },
                { url: 'Data/chat_2023_04_10.html', date: '2023-04-10' },
                { url: 'Data/chat_2023_04_11.html', date: '2023-04-11' },
                { url: 'Data/chat_2023_04_12.html', date: '2023-04-12' },
                { url: 'Data/chat_2023_04_13.html', date: '2023-04-13' },
                { url: 'Data/chat_2023_04_14.html', date: '2023-04-14' },
                { url: 'Data/chat_2023_04_15.html', date: '2023-04-15' },
                { url: 'Data/chat_2023_04_16.html', date: '2023-04-16' },
                { url: 'Data/chat_2023_04_17.html', date: '2023-04-17' },
                { url: 'Data/chat_2023_04_18.html', date: '2023-04-18' },
                { url: 'Data/chat_2023_04_19.html', date: '2023-04-19' },
                { url: 'Data/chat_2023_04_20.html', date: '2023-04-20' },
                { url: 'Data/chat_2023_04_21.html', date: '2023-04-21' },
                { url: 'Data/chat_2023_04_22.html', date: '2023-04-22' },
                { url: 'Data/chat_2023_04_23.html', date: '2023-04-23' },
                { url: 'Data/chat_2023_04_24.html', date: '2023-04-24' },
                { url: 'Data/chat_2023_04_25.html', date: '2023-04-25' },
                { url: 'Data/chat_2023_04_26.html', date: '2023-04-26' },
                { url: 'Data/chat_2023_04_27.html', date: '2023-04-27' },
                { url: 'Data/chat_2023_04_28.html', date: '2023-04-28' },
                { url: 'Data/chat_2023_04_29.html', date: '2023-04-29' },
                { url: 'Data/chat_2023_04_30.html', date: '2023-04-30' },
                { url: 'Data/chat_2023_05_01.html', date: '2023-05-01' },
                { url: 'Data/chat_2023_05_02.html', date: '2023-05-02' },
                { url: 'Data/chat_2023_05_03.html', date: '2023-05-03' },
                { url: 'Data/chat_2023_05_04.html', date: '2023-05-04' },
                { url: 'Data/chat_2023_05_05.html', date: '2023-05-05' },
                { url: 'Data/chat_2023_05_06.html', date: '2023-05-06' },
                { url: 'Data/chat_2023_05_07.html', date: '2023-05-07' },
                { url: 'Data/chat_2023_05_08.html', date: '2023-05-08' },
                { url: 'Data/chat_2023_05_09.html', date: '2023-05-09' },
                { url: 'Data/chat_2023_05_10.html', date: '2023-05-10' },
                { url: 'Data/chat_2023_05_11.html', date: '2023-05-11' },
                { url: 'Data/chat_2023_05_12.html', date: '2023-05-12' },
                { url: 'Data/chat_2023_05_13.html', date: '2023-05-13' },
                { url: 'Data/chat_2023_05_14.html', date: '2023-05-14' },
                { url: 'Data/chat_2023_05_15.html', date: '2023-05-15' },
                { url: 'Data/chat_2023_05_16.html', date: '2023-05-16' },
                { url: 'Data/chat_2023_05_17.html', date: '2023-05-17' },
                { url: 'Data/chat_2023_05_18.html', date: '2023-05-18' },
                { url: 'Data/chat_2023_05_19.html', date: '2023-05-19' },
                { url: 'Data/chat_2023_05_20.html', date: '2023-05-20' },
                { url: 'Data/chat_2023_05_21.html', date: '2023-05-21' },
                { url: 'Data/chat_2023_05_22.html', date: '2023-05-22' },
                { url: 'Data/chat_2023_05_23.html', date: '2023-05-23' },
                { url: 'Data/chat_2023_05_24.html', date: '2023-05-24' },
                { url: 'Data/chat_2023_05_25.html', date: '2023-05-25' },
                { url: 'Data/chat_2023_05_26.html', date: '2023-05-26' },
                { url: 'Data/chat_2023_05_27.html', date: '2023-05-27' },
                { url: 'Data/chat_2023_05_28.html', date: '2023-05-28' },
                { url: 'Data/chat_2023_05_29.html', date: '2023-05-29' },
                { url: 'Data/chat_2023_05_30.html', date: '2023-05-30' },
                { url: 'Data/chat_2023_05_31.html', date: '2023-05-31' },
                { url: 'Data/chat_2023_06_01.html', date: '2023-06-01' },
                { url: 'Data/chat_2023_06_02.html', date: '2023-06-02' },
                { url: 'Data/chat_2023_06_03.html', date: '2023-06-03' },
                { url: 'Data/chat_2023_06_04.html', date: '2023-06-04' },
                { url: 'Data/chat_2023_06_05.html', date: '2023-06-05' },
                { url: 'Data/chat_2023_06_06.html', date: '2023-06-06' },
                { url: 'Data/chat_2023_06_07.html', date: '2023-06-07' },
                { url: 'Data/chat_2023_06_08.html', date: '2023-06-08' },
                { url: 'Data/chat_2023_06_09.html', date: '2023-06-09' },
                { url: 'Data/chat_2023_06_10.html', date: '2023-06-10' },
                { url: 'Data/chat_2023_06_11.html', date: '2023-06-11' },
                { url: 'Data/chat_2023_06_12.html', date: '2023-06-12' },
                { url: 'Data/chat_2023_06_13.html', date: '2023-06-13' },
                { url: 'Data/chat_2023_06_14.html', date: '2023-06-14' },
                { url: 'Data/chat_2023_06_15.html', date: '2023-06-15' },
                { url: 'Data/chat_2023_06_16.html', date: '2023-06-16' },
                { url: 'Data/chat_2023_06_17.html', date: '2023-06-17' },
                { url: 'Data/chat_2023_06_18.html', date: '2023-06-18' },
                { url: 'Data/chat_2023_06_19.html', date: '2023-06-19' },
                { url: 'Data/chat_2023_06_20.html', date: '2023-06-20' },
                { url: 'Data/chat_2023_06_21.html', date: '2023-06-21' },
                { url: 'Data/chat_2023_06_22.html', date: '2023-06-22' },
                { url: 'Data/chat_2023_06_23.html', date: '2023-06-23' },
                { url: 'Data/chat_2023_06_24.html', date: '2023-06-24' },
                { url: 'Data/chat_2023_06_25.html', date: '2023-06-25' },
                { url: 'Data/chat_2023_06_26.html', date: '2023-06-26' },
                { url: 'Data/chat_2023_06_27.html', date: '2023-06-27' },
                { url: 'Data/chat_2023_06_28.html', date: '2023-06-28' },
                { url: 'Data/chat_2023_06_29.html', date: '2023-06-29' },
                { url: 'Data/chat_2023_06_30.html', date: '2023-06-30' },
                { url: 'Data/chat_2023_07_01.html', date: '2023-07-01' },
                { url: 'Data/chat_2023_07_02.html', date: '2023-07-02' },
                { url: 'Data/chat_2023_07_03.html', date: '2023-07-03' },
                { url: 'Data/chat_2023_07_04.html', date: '2023-07-04' },
                { url: 'Data/chat_2023_07_05.html', date: '2023-07-05' },
                { url: 'Data/chat_2023_07_06.html', date: '2023-07-06' },
                { url: 'Data/chat_2023_07_07.html', date: '2023-07-07' },
                { url: 'Data/chat_2023_07_08.html', date: '2023-07-08' },
                { url: 'Data/chat_2023_07_09.html', date: '2023-07-09' },
                { url: 'Data/chat_2023_07_10.html', date: '2023-07-10' },
                { url: 'Data/chat_2023_07_11.html', date: '2023-07-11' },
                { url: 'Data/chat_2023_07_12.html', date: '2023-07-12' },
                { url: 'Data/chat_2023_07_13.html', date: '2023-07-13' },
                { url: 'Data/chat_2023_07_14.html', date: '2023-07-14' },
                { url: 'Data/chat_2023_07_15.html', date: '2023-07-15' },
                { url: 'Data/chat_2023_07_16.html', date: '2023-07-16' },
                { url: 'Data/chat_2023_07_17.html', date: '2023-07-17' },
                { url: 'Data/chat_2023_07_18.html', date: '2023-07-18' },
                { url: 'Data/chat_2023_07_19.html', date: '2023-07-19' },
                { url: 'Data/chat_2023_07_20.html', date: '2023-07-20' },
                { url: 'Data/chat_2023_07_21.html', date: '2023-07-21' },
                { url: 'Data/chat_2023_07_22.html', date: '2023-07-22' },
                { url: 'Data/chat_2023_07_23.html', date: '2023-07-23' },
                { url: 'Data/chat_2023_07_24.html', date: '2023-07-24' },
                { url: 'Data/chat_2023_07_25.html', date: '2023-07-25' },
                { url: 'Data/chat_2023_07_26.html', date: '2023-07-26' },
                { url: 'Data/chat_2023_07_27.html', date: '2023-07-27' },
                { url: 'Data/chat_2023_07_28.html', date: '2023-07-28' },
                { url: 'Data/chat_2023_07_29.html', date: '2023-07-29' },
                { url: 'Data/chat_2023_07_30.html', date: '2023-07-30' },
                { url: 'Data/chat_2023_07_31.html', date: '2023-07-31' },
                { url: 'Data/chat_2023_08_01.html', date: '2023-08-01' },
                { url: 'Data/chat_2023_08_02.html', date: '2023-08-02' },
                { url: 'Data/chat_2023_08_03.html', date: '2023-08-03' },
                { url: 'Data/chat_2023_08_04.html', date: '2023-08-04' },
                { url: 'Data/chat_2023_08_05.html', date: '2023-08-05' },
                { url: 'Data/chat_2023_08_06.html', date: '2023-08-06' },
                { url: 'Data/chat_2023_08_07.html', date: '2023-08-07' },
                { url: 'Data/chat_2023_08_08.html', date: '2023-08-08' },
                { url: 'Data/chat_2023_08_09.html', date: '2023-08-09' },
                { url: 'Data/chat_2023_08_10.html', date: '2023-08-10' },
                { url: 'Data/chat_2023_08_11.html', date: '2023-08-11' },
                { url: 'Data/chat_2023_08_12.html', date: '2023-08-12' },
                { url: 'Data/chat_2023_08_13.html', date: '2023-08-13' },
                { url: 'Data/chat_2023_08_14.html', date: '2023-08-14' },
                { url: 'Data/chat_2023_08_15.html', date: '2023-08-15' },
                { url: 'Data/chat_2023_08_16.html', date: '2023-08-16' },
                { url: 'Data/chat_2023_08_17.html', date: '2023-08-17' },
                { url: 'Data/chat_2023_08_18.html', date: '2023-08-18' },
                { url: 'Data/chat_2023_08_19.html', date: '2023-08-19' },
                { url: 'Data/chat_2023_08_20.html', date: '2023-08-20' },
                { url: 'Data/chat_2023_08_21.html', date: '2023-08-21' },
                { url: 'Data/chat_2023_08_22.html', date: '2023-08-22' },
                { url: 'Data/chat_2023_08_23.html', date: '2023-08-23' },
                { url: 'Data/chat_2023_08_24.html', date: '2023-08-24' },
                { url: 'Data/chat_2023_08_25.html', date: '2023-08-25' },
                { url: 'Data/chat_2023_08_26.html', date: '2023-08-26' },
                { url: 'Data/chat_2023_08_27.html', date: '2023-08-27' },
                { url: 'Data/chat_2023_08_28.html', date: '2023-08-28' },
                { url: 'Data/chat_2023_08_29.html', date: '2023-08-29' },
                { url: 'Data/chat_2023_08_30.html', date: '2023-08-30' },
                { url: 'Data/chat_2023_08_31.html', date: '2023-08-31' },
                { url: 'Data/chat_2023_09_01.html', date: '2023-09-01' },
                { url: 'Data/chat_2023_09_02.html', date: '2023-09-02' },
                { url: 'Data/chat_2023_09_03.html', date: '2023-09-03' },
                { url: 'Data/chat_2023_09_04.html', date: '2023-09-04' },
                { url: 'Data/chat_2023_09_05.html', date: '2023-09-05' },
                { url: 'Data/chat_2023_09_06.html', date: '2023-09-06' },
                { url: 'Data/chat_2023_09_07.html', date: '2023-09-07' },
                { url: 'Data/chat_2023_09_08.html', date: '2023-09-08' },
                { url: 'Data/chat_2023_09_09.html', date: '2023-09-09' },
                { url: 'Data/chat_2023_09_10.html', date: '2023-09-10' },
                { url: 'Data/chat_2023_09_11.html', date: '2023-09-11' },
                { url: 'Data/chat_2023_09_12.html', date: '2023-09-12' },
                { url: 'Data/chat_2023_09_13.html', date: '2023-09-13' },
                { url: 'Data/chat_2023_09_14.html', date: '2023-09-14' },
                { url: 'Data/chat_2023_09_15.html', date: '2023-09-15' },
                { url: 'Data/chat_2023_09_16.html', date: '2023-09-16' },
                { url: 'Data/chat_2023_09_17.html', date: '2023-09-17' },
                { url: 'Data/chat_2023_09_18.html', date: '2023-09-18' },
                { url: 'Data/chat_2023_09_19.html', date: '2023-09-19' },
                { url: 'Data/chat_2023_09_20.html', date: '2023-09-20' },
                { url: 'Data/chat_2023_09_21.html', date: '2023-09-21' },
                { url: 'Data/chat_2023_09_22.html', date: '2023-09-22' },
                { url: 'Data/chat_2023_09_23.html', date: '2023-09-23' },
                { url: 'Data/chat_2023_09_24.html', date: '2023-09-24' },
                { url: 'Data/chat_2023_09_25.html', date: '2023-09-25' },
                { url: 'Data/chat_2023_09_26.html', date: '2023-09-26' },
                { url: 'Data/chat_2023_09_27.html', date: '2023-09-27' },
                { url: 'Data/chat_2023_09_28.html', date: '2023-09-28' },
                { url: 'Data/chat_2023_09_29.html', date: '2023-09-29' },
                { url: 'Data/chat_2023_09_30.html', date: '2023-09-30' },
                { url: 'Data/chat_2023_10_01.html', date: '2023-10-01' },
                { url: 'Data/chat_2023_10_02.html', date: '2023-10-02' },
                { url: 'Data/chat_2023_10_03.html', date: '2023-10-03' },
                { url: 'Data/chat_2023_10_04.html', date: '2023-10-04' },
                { url: 'Data/chat_2023_10_05.html', date: '2023-10-05' },
                { url: 'Data/chat_2023_10_06.html', date: '2023-10-06' },
                { url: 'Data/chat_2023_10_07.html', date: '2023-10-07' },
                { url: 'Data/chat_2023_10_08.html', date: '2023-10-08' },
                { url: 'Data/chat_2023_10_09.html', date: '2023-10-09' },
                { url: 'Data/chat_2023_10_10.html', date: '2023-10-10' },
                { url: 'Data/chat_2023_10_11.html', date: '2023-10-11' },
                { url: 'Data/chat_2023_10_12.html', date: '2023-10-12' },
                { url: 'Data/chat_2023_10_13.html', date: '2023-10-13' },
                { url: 'Data/chat_2023_10_14.html', date: '2023-10-14' },
                { url: 'Data/chat_2023_10_15.html', date: '2023-10-15' },
                { url: 'Data/chat_2023_10_16.html', date: '2023-10-16' },
                { url: 'Data/chat_2023_10_17.html', date: '2023-10-17' },
                { url: 'Data/chat_2023_10_18.html', date: '2023-10-18' },
                { url: 'Data/chat_2023_10_19.html', date: '2023-10-19' },
                { url: 'Data/chat_2023_10_20.html', date: '2023-10-20' },
                { url: 'Data/chat_2023_10_21.html', date: '2023-10-21' },
                { url: 'Data/chat_2023_10_22.html', date: '2023-10-22' },
                { url: 'Data/chat_2023_10_23.html', date: '2023-10-23' },
                { url: 'Data/chat_2023_10_24.html', date: '2023-10-24' },
                { url: 'Data/chat_2023_10_25.html', date: '2023-10-25' },
                { url: 'Data/chat_2023_10_26.html', date: '2023-10-26' },
                { url: 'Data/chat_2023_10_27.html', date: '2023-10-27' },
                { url: 'Data/chat_2023_10_28.html', date: '2023-10-28' },
                { url: 'Data/chat_2023_10_29.html', date: '2023-10-29' },
                { url: 'Data/chat_2023_10_30.html', date: '2023-10-30' },
                { url: 'Data/chat_2023_10_31.html', date: '2023-10-31' },
                { url: 'Data/chat_2023_11_01.html', date: '2023-11-01' },
                { url: 'Data/chat_2023_11_02.html', date: '2023-11-02' },
                { url: 'Data/chat_2023_11_03.html', date: '2023-11-03' },
                { url: 'Data/chat_2023_11_04.html', date: '2023-11-04' },
                { url: 'Data/chat_2023_11_05.html', date: '2023-11-05' },
                { url: 'Data/chat_2023_11_06.html', date: '2023-11-06' },
                { url: 'Data/chat_2023_11_07.html', date: '2023-11-07' },
                { url: 'Data/chat_2023_11_08.html', date: '2023-11-08' },
                { url: 'Data/chat_2023_11_09.html', date: '2023-11-09' },
                { url: 'Data/chat_2023_11_10.html', date: '2023-11-10' },
                { url: 'Data/chat_2023_11_11.html', date: '2023-11-11' },
                { url: 'Data/chat_2023_11_12.html', date: '2023-11-12' },
                { url: 'Data/chat_2023_11_13.html', date: '2023-11-13' },
                { url: 'Data/chat_2023_11_14.html', date: '2023-11-14' },
                { url: 'Data/chat_2023_11_15.html', date: '2023-11-15' },
                { url: 'Data/chat_2023_11_16.html', date: '2023-11-16' },
                { url: 'Data/chat_2023_11_17.html', date: '2023-11-17' },
                { url: 'Data/chat_2023_11_18.html', date: '2023-11-18' },
                { url: 'Data/chat_2023_11_21.html', date: '2023-11-21' },
                { url: 'Data/chat_2023_11_22.html', date: '2023-11-22' },
                { url: 'Data/chat_2023_11_23.html', date: '2023-11-23' },
                { url: 'Data/chat_2023_11_25.html', date: '2023-11-25' },
                { url: 'Data/chat_2023_11_27.html', date: '2023-11-27' },
                { url: 'Data/chat_2023_11_28.html', date: '2023-11-28' },
                { url: 'Data/chat_2024_01_01.html', date: '2024-01-01' },
                { url: 'Data/chat_2024_01_02.html', date: '2024-01-02' },
                { url: 'Data/chat_2024_01_03.html', date: '2024-01-03' },
                { url: 'Data/chat_2024_01_29.html', date: '2024-01-29' },
                { url: 'Data/chat_2024_01_30.html', date: '2024-01-30' },
                { url: 'Data/chat_2024_02_10.html', date: '2024-02-10' },
                { url: 'Data/chat_2024_03_01.html', date: '2024-03-01' },
                { url: 'Data/chat_2024_03_02.html', date: '2024-03-02' },
                { url: 'Data/chat_2024_03_03.html', date: '2024-03-03' },
                { url: 'Data/chat_2024_03_06.html', date: '2024-03-06' },
                { url: 'Data/chat_2024_03_07.html', date: '2024-03-07' },
                { url: 'Data/chat_2024_03_08.html', date: '2024-03-08' },
                { url: 'Data/chat_2024_03_09.html', date: '2024-03-09' },
                { url: 'Data/chat_2024_03_10.html', date: '2024-03-10' },
                { url: 'Data/chat_2024_03_11.html', date: '2024-03-11' },
                { url: 'Data/chat_2024_03_12.html', date: '2024-03-12' },
                { url: 'Data/chat_2024_03_13.html', date: '2024-03-13' },
                { url: 'Data/chat_2024_03_14.html', date: '2024-03-14' },
                { url: 'Data/chat_2024_03_15.html', date: '2024-03-15' },
                { url: 'Data/chat_2024_03_16.html', date: '2024-03-16' },
                { url: 'Data/chat_2024_03_17.html', date: '2024-03-17' },
                { url: 'Data/chat_2024_03_18.html', date: '2024-03-18' },
                { url: 'Data/chat_2024_03_19.html', date: '2024-03-19' },
                { url: 'Data/chat_2024_03_20.html', date: '2024-03-20' },
                { url: 'Data/chat_2024_03_21.html', date: '2024-03-21' },
                { url: 'Data/chat_2024_03_22.html', date: '2024-03-22' },
                { url: 'Data/chat_2024_03_23.html', date: '2024-03-23' },
                { url: 'Data/chat_2024_03_24.html', date: '2024-03-24' },
                { url: 'Data/chat_2024_03_25.html', date: '2024-03-25' },
                { url: 'Data/chat_2024_03_27.html', date: '2024-03-27' },
                { url: 'Data/chat_2024_03_28.html', date: '2024-03-28' },
                { url: 'Data/chat_2024_03_29.html', date: '2024-03-29' },
                { url: 'Data/chat_2024_03_30.html', date: '2024-03-30' },
                { url: 'Data/chat_2024_04_01.html', date: '2024-04-01' },
                { url: 'Data/chat_2024_04_02.html', date: '2024-04-02' },
                { url: 'Data/chat_2024_04_03.html', date: '2024-04-03' },
                { url: 'Data/chat_2024_04_04.html', date: '2024-04-04' },
                { url: 'Data/chat_2024_04_06.html', date: '2024-04-06' },
                { url: 'Data/chat_2024_04_17.html', date: '2024-04-17' },
                { url: 'Data/chat_2024_04_21.html', date: '2024-04-21' },
                { url: 'Data/chat_2024_04_22.html', date: '2024-04-22' },
                { url: 'Data/chat_2024_04_23.html', date: '2024-04-23' },
                { url: 'Data/chat_2024_04_25.html', date: '2024-04-25' },
                { url: 'Data/chat_2024_04_26.html', date: '2024-04-26' },
                { url: 'Data/chat_2024_04_28.html', date: '2024-04-28' },
                { url: 'Data/chat_2025_05_12.html', date: '2025-05-12' },
                { url: 'Data/chat_2025_07_03.html', date: '2025-07-03' },
                { url: 'Data/chat_2025_07_09.html', date: '2025-07-09' },
                { url: 'Data/chat_2025_07_10.html', date: '2025-07-10' },
                { url: 'Data/chat_2025_07_19.html', date: '2025-07-19' },
                { url: 'Data/chat_2025_07_22.html', date: '2025-07-22' },
                { url: 'Data/chat_2025_07_25.html', date: '2025-07-25' },
                { url: 'Data/chat_2025_07_27.html', date: '2025-07-27' },
                { url: 'Data/chat_2025_08_26.html', date: '2025-08-26' },
                { url: 'Data/chat_2025_08_27.html', date: '2025-08-27' },
                { url: 'Data/chat_2025_08_28.html', date: '2025-08-28' },
                { url: 'Data/chat_2025_08_29.html', date: '2025-08-29' },
                { url: 'Data/chat_2025_09_19.html', date: '2025-09-19' },
                { url: 'Data/chat_2025_09_28.html', date: '2025-09-28' }
            ];
        }

        // ä½¿ç”¨iframeåŠ è½½æ–‡ä»¶
        function loadFileWithIframe(url) {
            return new Promise((resolve, reject) => {
                const iframe = document.getElementById('loadFrame');
                iframe.onload = function() {
                    try {
                        const doc = iframe.contentDocument || iframe.contentWindow.document;
                        resolve(doc);
                    } catch (e) {
                        reject(e);
                    }
                };
                iframe.onerror = function() {
                    reject(new Error('Failed to load file: ' + url));
                };
                iframe.src = url;
            });
        }

        // æœç´¢å•ä¸ªæ–‡ä»¶
        async function searchFile(file, searchTerm, senderFilter, mediaFilter) {
            try {
                // æ£€æŸ¥ç¼“å­˜
                if (fileCache.has(file.url)) {
                    const messages = fileCache.get(file.url);
                    return filterMessages(messages, searchTerm, senderFilter, mediaFilter, file);
                }

                // åŠ è½½æ–‡ä»¶
                const doc = await loadFileWithIframe(file.url);
                
                // è§£ææ¶ˆæ¯ - ä½¿ç”¨æ­£ç¡®çš„DOMé€‰æ‹©å™¨
                const messageElements = doc.querySelectorAll('.message');
                const messages = [];

                messageElements.forEach(message => {
                    try {
                        const senderElement = message.querySelector('.sender');
                        const contentElement = message.querySelector('.message-content');
                        const timeElement = message.querySelector('.time');

                        if (senderElement && contentElement) {
                            const sender = senderElement.textContent.trim();
                            let content = contentElement.textContent.trim();
                            
                            // å¤„ç†è¡¨æƒ…å›¾ç‰‡
                            const imgElements = contentElement.querySelectorAll('img');
                            let hasImage = imgElements.length > 0;
                            let hasEmoji = false;
                            
                            imgElements.forEach(img => {
                                const alt = img.getAttribute('alt');
                                if (alt && alt.startsWith('/')) {
                                    hasEmoji = true;
                                    content += ` ${alt}`;
                                }
                            });

                            const message = {
                                sender: sender,
                                content: content,
                                time: timeElement ? timeElement.textContent.trim() : '',
                                fileUrl: file.url,
                                date: file.date,
                                hasImage: hasImage,
                                hasEmoji: hasEmoji,
                                mediaType: hasEmoji ? 'emoji' : (hasImage ? 'image' : 'text')
                            };
                            messages.push(message);
                        }
                    } catch (e) {
                        console.warn('Error parsing message:', e);
                    }
                });

                // ç¼“å­˜ç»“æœ
                fileCache.set(file.url, messages);
                
                return filterMessages(messages, searchTerm, senderFilter, mediaFilter, file);
            } catch (error) {
                console.error('Error searching file:', file.url, error);
                return [];
            }
        }

        // è¿‡æ»¤æ¶ˆæ¯
        function filterMessages(messages, searchTerm, senderFilter, mediaFilter, file) {
            return messages.filter(message => {
                // å…³é”®è¯è¿‡æ»¤
                if (searchTerm && !message.content.toLowerCase().includes(searchTerm.toLowerCase())) {
                    return false;
                }
                
                // å‘é€è€…è¿‡æ»¤
                if (senderFilter && message.sender !== senderFilter) {
                    return false;
                }
                
                // åª’ä½“ç±»å‹è¿‡æ»¤
                if (mediaFilter && message.mediaType !== mediaFilter) {
                    return false;
                }
                
                return true;
            });
        }

        // è·å–åª’ä½“ç±»å‹
        function getMediaType(content) {
            if (content.includes('<img')) {
                const imgMatch = content.match(/alt="([^"]+)"/);
                if (imgMatch && imgMatch[1].startsWith('/')) {
                    return 'emoji';
                }
                return 'image';
            }
            return 'text';
        }

        // æ‰§è¡Œæœç´¢
        async function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const senderFilter = document.getElementById('senderFilter').value;
            const mediaFilter = document.getElementById('mediaFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').innerHTML = '';
            document.getElementById('pagination').innerHTML = '';

            // è¿‡æ»¤æ–‡ä»¶
            let filesToSearch = allFiles.filter(file => {
                if (dateFrom && file.date < dateFrom) return false;
                if (dateTo && file.date > dateTo) return false;
                return true;
            });

            // å¹¶è¡Œæœç´¢æ–‡ä»¶
            const searchPromises = filesToSearch.map(file => 
                searchFile(file, searchTerm, senderFilter, mediaFilter)
            );

            try {
                const allResults = await Promise.all(searchPromises);
                searchResults = allResults.flat();

                // æŒ‰æ—¶é—´æ’åº
                searchResults.sort((a, b) => {
                    const timeA = new Date(a.date + ' ' + a.time);
                    const timeB = new Date(b.date + ' ' + b.time);
                    return timeB - timeA;
                });

                // æ˜¾ç¤ºç»“æœ
                displayResults();
                updateStats();

            } catch (error) {
                console.error('Search error:', error);
                document.getElementById('results').innerHTML = '<div class="no-results">æœç´¢å‡ºé”™ï¼Œè¯·é‡è¯•</div>';
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displayResults() {
            const resultsContainer = document.getElementById('results');
            
            if (searchResults.length === 0) {
                resultsContainer.innerHTML = '<div class="no-results">æœªæ‰¾åˆ°åŒ¹é…çš„èŠå¤©è®°å½•</div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            // åˆ†é¡µ
            const startIndex = (currentPage - 1) * resultsPerPage;
            const endIndex = startIndex + resultsPerPage;
            const pageResults = searchResults.slice(startIndex, endIndex);

            // ç”Ÿæˆç»“æœHTML
            let html = '';
            pageResults.forEach(result => {
                const highlightedContent = highlightSearchTerm(result.content, document.getElementById('searchInput').value);
                html += `
                    <div class="result-item" onclick="openChatFile('${result.fileUrl}', '${result.time}')">
                        <div class="result-date">${result.date} ${result.time}</div>
                        <div class="result-sender">${result.sender}</div>
                        <div class="result-content">${highlightedContent}</div>
                    </div>
                `;
            });

            resultsContainer.innerHTML = html;
            
            // ç”Ÿæˆåˆ†é¡µ
            createPagination();
        }

        // é«˜äº®æœç´¢å…³é”®è¯
        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // åˆ›å»ºåˆ†é¡µæ§ä»¶
        function createPagination() {
            const totalPages = Math.ceil(searchResults.length / resultsPerPage);
            const paginationContainer = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let html = '';
            
            // ä¸Šä¸€é¡µ
            if (currentPage > 1) {
                html += `<button onclick="changePage(${currentPage - 1})">ä¸Šä¸€é¡µ</button>`;
            }
            
            // é¡µç 
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<button class="active">${i}</button>`;
                } else {
                    html += `<button onclick="changePage(${i})">${i}</button>`;
                }
            }
            
            // ä¸‹ä¸€é¡µ
            if (currentPage < totalPages) {
                html += `<button onclick="changePage(${currentPage + 1})">ä¸‹ä¸€é¡µ</button>`;
            }
            
            paginationContainer.innerHTML = html;
        }

        // åˆ‡æ¢é¡µé¢
        function changePage(page) {
            currentPage = page;
            displayResults();
        }

        // æ‰“å¼€èŠå¤©æ–‡ä»¶
        function openChatFile(fileUrl, time) {
            // åœ¨æ–°çª—å£ä¸­æ‰“å¼€èŠå¤©æ–‡ä»¶ï¼Œå¹¶æ»šåŠ¨åˆ°æŒ‡å®šæ—¶é—´
            window.open(fileUrl + '#time=' + encodeURIComponent(time), '_blank');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const statsContent = document.getElementById('statsContent');
            const searchTerm = document.getElementById('searchInput').value.trim();
            const filesSearched = fileCache.size;
            
            statsContent.innerHTML = `
                æœç´¢å…³é”®è¯: "${searchTerm || 'å…¨éƒ¨'}" | 
                æ‰¾åˆ° ${searchResults.length} æ¡ç»“æœ | 
                æœç´¢äº† ${filesSearched} ä¸ªæ–‡ä»¶
            `;
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // å›è½¦é”®æœç´¢
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // å®æ—¶æœç´¢ï¼ˆé˜²æŠ–ï¼‰
            let searchTimeout;
            document.getElementById('searchInput').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(performSearch, 500);
            });

            // ç­›é€‰æ¡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨æœç´¢
            ['senderFilter', 'mediaFilter', 'dateFrom', 'dateTo'].forEach(id => {
                document.getElementById(id).addEventListener('change', performSearch);
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeFileList();
            setupEventListeners();
            
            // æ˜¾ç¤ºåˆå§‹ç»Ÿè®¡
            updateStats();
        });
    </script>
</body>
</html>