<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>头像路径修复工具</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        .file-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f8f9fa;
        }
        .path-display {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            word-break: break-all;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>聊天记录头像路径修复工具</h1>
        
        <div class="section info">
            <h3>问题分析</h3>
            <p>头像无法显示的原因是：<strong>中文路径在浏览器中被URL编码</strong></p>
            <div class="path-display">
                原始路径：../生生[2137463976]/individual-image/2872215021-星如雨.jpg<br>
                浏览器编码：../%E7%94%9F%E7%94%9F[2137463976]/individual-image/2872215021-%E6%98%9F%E5%A6%82%E9%9B%A8.jpg
            </div>
        </div>

        <div class="section">
            <h3>头像文件检测</h3>
            <div id="avatarStatus">检测中...</div>
            <button onclick="checkAvatars()">重新检测头像</button>
        </div>

        <div class="section">
            <h3>修复方案</h3>
            <p>点击下面的按钮应用修复方案：</p>
            <button onclick="fixRelativePaths()">修复相对路径</button>
            <button onclick="createAbsolutePaths()">使用绝对路径</button>
            <button onclick="copyAvatarsToData()">复制头像到Data目录</button>
        </div>

        <div class="section">
            <h3>修复结果</h3>
            <div id="fixResult">等待修复...</div>
        </div>
    </div>

    <script>
        // 头像文件路径配置
        const avatarConfig = {
            basePath: "c:\\Users\\ASUS\\Desktop\\游戏\\星如雨[2872215021]",
            relativePath: "../生生[2137463976]/individual-image/",
            avatars: [
                "2872215021-星如雨.jpg",
                "2137463976-生生.jpg"
            ],
            dataPath: "./Data/"
        };

        // 检查头像文件是否存在
        function checkAvatars() {
            const statusDiv = document.getElementById('avatarStatus');
            statusDiv.innerHTML = '<div>检测中...</div>';
            
            let results = [];
            
            avatarConfig.avatars.forEach(avatar => {
                const relativePath = avatarConfig.relativePath + avatar;
                const absolutePath = avatarConfig.basePath + "\\生生[2137463976]\\individual-image\\" + avatar;
                
                // 创建测试图片来检测路径
                const img = new Image();
                img.onload = function() {
                    results.push(`✓ ${avatar} - 相对路径可用`);
                    updateStatus();
                };
                img.onerror = function() {
                    results.push(`✗ ${avatar} - 相对路径失败`);
                    updateStatus();
                };
                img.src = relativePath;
            });
            
            function updateStatus() {
                if (results.length === avatarConfig.avatars.length) {
                    statusDiv.innerHTML = results.join('<br>') + 
                        '<br><br><strong>建议：</strong>使用绝对路径或复制头像到Data目录可解决此问题。';
                }
            }
        }

        // 修复相对路径（使用URL编码处理）
        function fixRelativePaths() {
            const resultDiv = document.getElementById('fixResult');
            resultDiv.innerHTML = '<div>正在修复相对路径...</div>';
            
            // 这里需要修改实际的聊天记录文件
            // 由于浏览器安全限制，我们需要提供修复后的文件内容供用户手动替换
            
            const fixedPath = "./生生[2137463976]/individual-image/";
            resultDiv.innerHTML = `
                <div class="success">
                    <h4>相对路径修复方案</h4>
                    <p>将头像路径修改为：<code>${fixedPath}</code></p>
                    <p>请在聊天记录文件中将所有头像路径替换为上述格式。</p>
                    <div class="path-display">
                        查找：../生生[2137463976]/individual-image/<br>
                        替换为：./生生[2137463976]/individual-image/
                    </div>
                </div>
            `;
        }

        // 创建绝对路径版本
        function createAbsolutePaths() {
            const resultDiv = document.getElementById('fixResult');
            const absolutePath = "file:///c:/Users/ASUS/Desktop/游戏/星如雨[2872215021]/生生[2137463976]/individual-image/";
            
            resultDiv.innerHTML = `
                <div class="success">
                    <h4>绝对路径修复方案</h4>
                    <p>将头像路径修改为绝对路径：</p>
                    <div class="path-display">
                        ${absolutePath}
                    </div>
                    <p>这样可以避免中文路径编码问题。</p>
                </div>
            `;
        }

        // 复制头像到Data目录方案
        function copyAvatarsToData() {
            const resultDiv = document.getElementById('fixResult');
            
            resultDiv.innerHTML = `
                <div class="success">
                    <h4>复制头像到Data目录方案</h4>
                    <p>将头像文件复制到Data目录，然后使用相对路径：</p>
                    <div class="path-display">
                        目标目录：./Data/avatars/<br>
                        新路径：./avatars/2872215021-星如雨.jpg
                    </div>
                    <p><strong>操作步骤：</strong></p>
                    <ol>
                        <li>在Data目录下创建avatars文件夹</li>
                        <li>将头像文件复制到该文件夹</li>
                        <li>修改聊天记录中的头像路径</li>
                    </ol>
                    <button onclick="createAvatarFolder()">创建avatars文件夹</button>
                </div>
            `;
        }

        // 创建avatars文件夹（模拟）
        function createAvatarFolder() {
            alert('请在Data目录下手动创建avatars文件夹，然后将头像文件复制过去。');
        }

        // 页面加载时自动检测
        window.onload = function() {
            checkAvatars();
        };
    </script>
</body>
</html>