<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°èŠå¤©è®°å½•æœç´¢ - ä½¿ç”¨iframeæ–¹å¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .search-section {
            padding: 30px;
            background: #f8f9fa;
        }

        .search-controls {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }

        .filter-group select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .debug-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .debug-section h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        .results-section {
            padding: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-header h2 {
            color: #495057;
            font-size: 1.5em;
        }

        .results-count {
            background: #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: #495057;
        }

        .result-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .result-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .result-sender {
            font-weight: 600;
            color: #007bff;
        }

        .result-time {
            color: #6c757d;
            font-size: 0.9em;
        }

        .result-content {
            color: #495057;
            line-height: 1.6;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .result-file {
            margin-top: 10px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .hidden {
            display: none;
        }

        /* éšè—çš„iframeç”¨äºåŠ è½½æ–‡ä»¶ */
        .hidden-iframe {
            display: none;
        }

        .stats-section {
            background: #e9ecef;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #007bff;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” æœ¬åœ°èŠå¤©è®°å½•æœç´¢</h1>
            <p>ä½¿ç”¨iframeæ–¹å¼æœç´¢æ‰€æœ‰èŠå¤©è®°å½•</p>
        </div>

        <div class="search-section">
            <div class="search-controls">
                <input type="text" id="searchInput" class="search-input" placeholder="è¾“å…¥æœç´¢å…³é”®è¯...">
                <button id="searchBtn" class="btn btn-primary">æœç´¢</button>
                <button id="clearBtn" class="btn btn-secondary">æ¸…é™¤</button>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label for="senderFilter">å‘é€è€…</label>
                    <select id="senderFilter">
                        <option value="">å…¨éƒ¨</option>
                        <option value="ç”Ÿç”Ÿ">ç”Ÿç”Ÿ</option>
                        <option value="æ˜Ÿå¦‚é›¨">æ˜Ÿå¦‚é›¨</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="dateFilter">æ—¥æœŸèŒƒå›´</label>
                    <select id="dateFilter">
                        <option value="">å…¨éƒ¨æ—¶é—´</option>
                        <option value="2022">2022å¹´</option>
                        <option value="2023">2023å¹´</option>
                        <option value="2024">2024å¹´</option>
                        <option value="2025">2025å¹´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="mediaFilter">åª’ä½“ç±»å‹</label>
                    <select id="mediaFilter">
                        <option value="">å…¨éƒ¨</option>
                        <option value="text">çº¯æ–‡æœ¬</option>
                        <option value="image">åŒ…å«å›¾ç‰‡</option>
                        <option value="video">åŒ…å«è§†é¢‘</option>
                        <option value="file">åŒ…å«æ–‡ä»¶</option>
                    </select>
                </div>
            </div>

            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalFiles">0</div>
                        <div class="stat-label">æ€»æ–‡ä»¶æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="searchedFiles">0</div>
                        <div class="stat-label">å·²æœç´¢</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalMessages">0</div>
                        <div class="stat-label">æ€»æ¶ˆæ¯æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="foundResults">0</div>
                        <div class="stat-label">æ‰¾åˆ°ç»“æœ</div>
                    </div>
                </div>
            </div>

            <div id="debugSection" class="debug-section">
                <h3>è°ƒè¯•ä¿¡æ¯</h3>
                <div id="debugContent">è°ƒè¯•ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
            </div>
        </div>

        <div class="results-section">
            <div class="results-header">
                <h2>æœç´¢ç»“æœ</h2>
                <div class="results-count" id="resultsCount">å…±æ‰¾åˆ° 0 æ¡ç»“æœ</div>
            </div>
            <div id="resultsContainer">
                <div class="no-results">è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</div>
            </div>
        </div>
    </div>

    <!-- éšè—çš„iframeç”¨äºåŠ è½½æ–‡ä»¶ -->
    <iframe id="hiddenFrame" class="hidden-iframe"></iframe>

    <script>
        // å…¨å±€å˜é‡
        let allFiles = [];
        let searchResults = [];
        let isSearching = false;

        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(message) {
            const debugContent = document.getElementById('debugContent');
            const timestamp = new Date().toLocaleTimeString();
            debugContent.innerHTML += `[${timestamp}] ${message}\n`;
            debugContent.scrollTop = debugContent.scrollHeight;
            console.log(message);
        }

        // åˆå§‹åŒ–æ–‡ä»¶åˆ—è¡¨
        function initializeFileList() {
            debugLog('å¼€å§‹åˆå§‹åŒ–æ–‡ä»¶åˆ—è¡¨...');
            
            // åŸºäºå®é™…å­˜åœ¨çš„æ–‡ä»¶ç”Ÿæˆåˆ—è¡¨
            allFiles = [
                // 2022å¹´çš„æ–‡ä»¶
                {filename: 'chat_2022_09_24.html', url: 'Data/chat_2022_09_24.html', date: '2022_09_24', year: '2022'},
                {filename: 'chat_2022_10_01.html', url: 'Data/chat_2022_10_01.html', date: '2022_10_01', year: '2022'},
                {filename: 'chat_2022_10_02.html', url: 'Data/chat_2022_10_02.html', date: '2022_10_02', year: '2022'},
                {filename: 'chat_2022_10_05.html', url: 'Data/chat_2022_10_05.html', date: '2022_10_05', year: '2022'},
                {filename: 'chat_2022_10_06.html', url: 'Data/chat_2022_10_06.html', date: '2022_10_06', year: '2022'},
                {filename: 'chat_2022_10_07.html', url: 'Data/chat_2022_10_07.html', date: '2022_10_07', year: '2022'},
                {filename: 'chat_2022_10_09.html', url: 'Data/chat_2022_10_09.html', date: '2022_10_09', year: '2022'},
                {filename: 'chat_2022_10_10.html', url: 'Data/chat_2022_10_10.html', date: '2022_10_10', year: '2022'},
                {filename: 'chat_2022_10_11.html', url: 'Data/chat_2022_10_11.html', date: '2022_10_11', year: '2022'},
                {filename: 'chat_2022_10_14.html', url: 'Data/chat_2022_10_14.html', date: '2022_10_14', year: '2022'},
                {filename: 'chat_2022_10_15.html', url: 'Data/chat_2022_10_15.html', date: '2022_10_15', year: '2022'},
                {filename: 'chat_2022_10_16.html', url: 'Data/chat_2022_10_16.html', date: '2022_10_16', year: '2022'},
                {filename: 'chat_2022_10_20.html', url: 'Data/chat_2022_10_20.html', date: '2022_10_20', year: '2022'},
                {filename: 'chat_2022_10_21.html', url: 'Data/chat_2022_10_21.html', date: '2022_10_21', year: '2022'},
                {filename: 'chat_2022_10_22.html', url: 'Data/chat_2022_10_22.html', date: '2022_10_22', year: '2022'},
                {filename: 'chat_2022_10_23.html', url: 'Data/chat_2022_10_23.html', date: '2022_10_23', year: '2022'},
                {filename: 'chat_2022_10_26.html', url: 'Data/chat_2022_10_26.html', date: '2022_10_26', year: '2022'},
                {filename: 'chat_2022_10_28.html', url: 'Data/chat_2022_10_28.html', date: '2022_10_28', year: '2022'},
                {filename: 'chat_2022_10_29.html', url: 'Data/chat_2022_10_29.html', date: '2022_10_29', year: '2022'},
                {filename: 'chat_2022_10_30.html', url: 'Data/chat_2022_10_30.html', date: '2022_10_30', year: '2022'},
                {filename: 'chat_2022_10_31.html', url: 'Data/chat_2022_10_31.html', date: '2022_10_31', year: '2022'},
                {filename: 'chat_2022_11_01.html', url: 'Data/chat_2022_11_01.html', date: '2022_11_01', year: '2022'},
                {filename: 'chat_2022_11_02.html', url: 'Data/chat_2022_11_02.html', date: '2022_11_02', year: '2022'},
                {filename: 'chat_2022_11_03.html', url: 'Data/chat_2022_11_03.html', date: '2022_11_03', year: '2022'},
                {filename: 'chat_2022_11_04.html', url: 'Data/chat_2022_11_04.html', date: '2022_11_04', year: '2022'},
                {filename: 'chat_2022_11_05.html', url: 'Data/chat_2022_11_05.html', date: '2022_11_05', year: '2022'},
                {filename: 'chat_2022_11_06.html', url: 'Data/chat_2022_11_06.html', date: '2022_11_06', year: '2022'},
                {filename: 'chat_2022_11_07.html', url: 'Data/chat_2022_11_07.html', date: '2022_11_07', year: '2022'},
                {filename: 'chat_2022_11_09.html', url: 'Data/chat_2022_11_09.html', date: '2022_11_09', year: '2022'},
                {filename: 'chat_2022_11_10.html', url: 'Data/chat_2022_11_10.html', date: '2022_11_10', year: '2022'},
                {filename: 'chat_2022_11_11.html', url: 'Data/chat_2022_11_11.html', date: '2022_11_11', year: '2022'},
                {filename: 'chat_2022_11_12.html', url: 'Data/chat_2022_11_12.html', date: '2022_11_12', year: '2022'},
                {filename: 'chat_2022_11_13.html', url: 'Data/chat_2022_11_13.html', date: '2022_11_13', year: '2022'},
                {filename: 'chat_2022_11_14.html', url: 'Data/chat_2022_11_14.html', date: '2022_11_14', year: '2022'},
                {filename: 'chat_2022_11_15.html', url: 'Data/chat_2022_11_15.html', date: '2022_11_15', year: '2022'},
                {filename: 'chat_2022_11_16.html', url: 'Data/chat_2022_11_16.html', date: '2022_11_16', year: '2022'},
                {filename: 'chat_2022_11_17.html', url: 'Data/chat_2022_11_17.html', date: '2022_11_17', year: '2022'},
                {filename: 'chat_2022_11_18.html', url: 'Data/chat_2022_11_18.html', date: '2022_11_18', year: '2022'},
                {filename: 'chat_2022_11_19.html', url: 'Data/chat_2022_11_19.html', date: '2022_11_19', year: '2022'},
                {filename: 'chat_2022_11_20.html', url: 'Data/chat_2022_11_20.html', date: '2022_11_20', year: '2022'},
                {filename: 'chat_2022_11_21.html', url: 'Data/chat_2022_11_21.html', date: '2022_11_21', year: '2022'},
                {filename: 'chat_2022_11_22.html', url: 'Data/chat_2022_11_22.html', date: '2022_11_22', year: '2022'},
                {filename: 'chat_2022_11_23.html', url: 'Data/chat_2022_11_23.html', date: '2022_11_23', year: '2022'},
                {filename: 'chat_2022_11_24.html', url: 'Data/chat_2022_11_24.html', date: '2022_11_24', year: '2022'},
                {filename: 'chat_2022_11_25.html', url: 'Data/chat_2022_11_25.html', date: '2022_11_25', year: '2022'},
                {filename: 'chat_2022_11_26.html', url: 'Data/chat_2022_11_26.html', date: '2022_11_26', year: '2022'},
                {filename: 'chat_2022_11_27.html', url: 'Data/chat_2022_11_27.html', date: '2022_11_27', year: '2022'},
                {filename: 'chat_2022_11_28.html', url: 'Data/chat_2022_11_28.html', date: '2022_11_28', year: '2022'},
                {filename: 'chat_2022_11_29.html', url: 'Data/chat_2022_11_29.html', date: '2022_11_29', year: '2022'},
                {filename: 'chat_2022_11_30.html', url: 'Data/chat_2022_11_30.html', date: '2022_11_30', year: '2022'},
                {filename: 'chat_2022_12_02.html', url: 'Data/chat_2022_12_02.html', date: '2022_12_02', year: '2022'},
                {filename: 'chat_2022_12_03.html', url: 'Data/chat_2022_12_03.html', date: '2022_12_03', year: '2022'},
                {filename: 'chat_2022_12_10.html', url: 'Data/chat_2022_12_10.html', date: '2022_12_10', year: '2022'},
                {filename: 'chat_2022_12_12.html', url: 'Data/chat_2022_12_12.html', date: '2022_12_12', year: '2022'},
                {filename: 'chat_2022_12_20.html', url: 'Data/chat_2022_12_20.html', date: '2022_12_20', year: '2022'},
                {filename: 'chat_2022_12_28.html', url: 'Data/chat_2022_12_28.html', date: '2022_12_28', year: '2022'},
                {filename: 'chat_2022_12_29.html', url: 'Data/chat_2022_12_29.html', date: '2022_12_29', year: '2022'},
                {filename: 'chat_2022_12_30.html', url: 'Data/chat_2022_12_30.html', date: '2022_12_30', year: '2022'},
                {filename: 'chat_2022_12_31.html', url: 'Data/chat_2022_12_31.html', date: '2022_12_31', year: '2022'},
                // 2023å¹´çš„æ–‡ä»¶ï¼ˆéƒ¨åˆ†ç¤ºä¾‹ï¼‰
                {filename: 'chat_2023_01_01.html', url: 'Data/chat_2023_01_01.html', date: '2023_01_01', year: '2023'},
                {filename: 'chat_2023_01_02.html', url: 'Data/chat_2023_01_02.html', date: '2023_01_02', year: '2023'},
                {filename: 'chat_2023_01_03.html', url: 'Data/chat_2023_01_03.html', date: '2023_01_03', year: '2023'},
                {filename: 'chat_2023_01_04.html', url: 'Data/chat_2023_01_04.html', date: '2023_01_04', year: '2023'},
                {filename: 'chat_2023_01_05.html', url: 'Data/chat_2023_01_05.html', date: '2023_01_05', year: '2023'},
                {filename: 'chat_2023_01_06.html', url: 'Data/chat_2023_01_06.html', date: '2023_01_06', year: '2023'},
                {filename: 'chat_2023_01_07.html', url: 'Data/chat_2023_01_07.html', date: '2023_01_07', year: '2023'},
                {filename: 'chat_2023_01_08.html', url: 'Data/chat_2023_01_08.html', date: '2023_01_08', year: '2023'},
                {filename: 'chat_2023_01_09.html', url: 'Data/chat_2023_01_09.html', date: '2023_01_09', year: '2023'},
                {filename: 'chat_2023_01_10.html', url: 'Data/chat_2023_01_10.html', date: '2023_01_10', year: '2023'},
                {filename: 'chat_2023_01_11.html', url: 'Data/chat_2023_01_11.html', date: '2023_01_11', year: '2023'},
                {filename: 'chat_2023_01_12.html', url: 'Data/chat_2023_01_12.html', date: '2023_01_12', year: '2023'},
                {filename: 'chat_2023_01_13.html', url: 'Data/chat_2023_01_13.html', date: '2023_01_13', year: '2023'},
                {filename: 'chat_2023_01_14.html', url: 'Data/chat_2023_01_14.html', date: '2023_01_14', year: '2023'},
                {filename: 'chat_2023_01_15.html', url: 'Data/chat_2023_01_15.html', date: '2023_01_15', year: '2023'},
                {filename: 'chat_2023_01_16.html', url: 'Data/chat_2023_01_16.html', date: '2023_01_16', year: '2023'},
                {filename: 'chat_2023_01_17.html', url: 'Data/chat_2023_01_17.html', date: '2023_01_17', year: '2023'},
                {filename: 'chat_2023_01_18.html', url: 'Data/chat_2023_01_18.html', date: '2023_01_18', year: '2023'},
                {filename: 'chat_2023_01_19.html', url: 'Data/chat_2023_01_19.html', date: '2023_01_19', year: '2023'},
                {filename: 'chat_2023_01_20.html', url: 'Data/chat_2023_01_20.html', date: '2023_01_20', year: '2023'},
                {filename: 'chat_2023_01_21.html', url: 'Data/chat_2023_01_21.html', date: '2023_01_21', year: '2023'},
                {filename: 'chat_2023_01_22.html', url: 'Data/chat_2023_01_22.html', date: '2023_01_22', year: '2023'},
                {filename: 'chat_2023_01_23.html', url: 'Data/chat_2023_01_23.html', date: '2023_01_23', year: '2023'},
                {filename: 'chat_2023_01_24.html', url: 'Data/chat_2023_01_24.html', date: '2023_01_24', year: '2023'},
                {filename: 'chat_2023_01_25.html', url: 'Data/chat_2023_01_25.html', date: '2023_01_25', year: '2023'},
                {filename: 'chat_2023_01_26.html', url: 'Data/chat_2023_01_26.html', date: '2023_01_26', year: '2023'},
                {filename: 'chat_2023_01_27.html', url: 'Data/chat_2023_01_27.html', date: '2023_01_27', year: '2023'},
                {filename: 'chat_2023_01_28.html', url: 'Data/chat_2023_01_28.html', date: '2023_01_28', year: '2023'},
                {filename: 'chat_2023_01_29.html', url: 'Data/chat_2023_01_29.html', date: '2023_01_29', year: '2023'},
                {filename: 'chat_2023_01_30.html', url: 'Data/chat_2023_01_30.html', date: '2023_01_30', year: '2023'},
                {filename: 'chat_2023_01_31.html', url: 'Data/chat_2023_01_31.html', date: '2023_01_31', year: '2023'},
                {filename: 'chat_2023_02_01.html', url: 'Data/chat_2023_02_01.html', date: '2023_02_01', year: '2023'},
                {filename: 'chat_2023_02_02.html', url: 'Data/chat_2023_02_02.html', date: '2023_02_02', year: '2023'},
                {filename: 'chat_2023_02_03.html', url: 'Data/chat_2023_02_03.html', date: '2023_02_03', year: '2023'},
                {filename: 'chat_2023_02_04.html', url: 'Data/chat_2023_02_04.html', date: '2023_02_04', year: '2023'},
                {filename: 'chat_2023_02_05.html', url: 'Data/chat_2023_02_05.html', date: '2023_02_05', year: '2023'},
                {filename: 'chat_2023_02_06.html', url: 'Data/chat_2023_02_06.html', date: '2023_02_06', year: '2023'},
                {filename: 'chat_2023_02_07.html', url: 'Data/chat_2023_02_07.html', date: '2023_02_07', year: '2023'},
                {filename: 'chat_2023_02_08.html', url: 'Data/chat_2023_02_08.html', date: '2023_02_08', year: '2023'},
                {filename: 'chat_2023_02_09.html', url: 'Data/chat_2023_02_09.html', date: '2023_02_09', year: '2023'},
                {filename: 'chat_2023_02_10.html', url: 'Data/chat_2023_02_10.html', date: '2023_02_10', year: '2023'}
            ];
            
            debugLog(`æ–‡ä»¶åˆ—è¡¨åˆå§‹åŒ–å®Œæˆï¼Œå…± ${allFiles.length} ä¸ªæ–‡ä»¶`);
            document.getElementById('totalFiles').textContent = allFiles.length;
            
            // æµ‹è¯•ç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨
            testFirstFile();
        }

        // æµ‹è¯•ç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å¯ä»¥è®¿é—®
        function testFirstFile() {
            if (allFiles.length === 0) return;
            
            const firstFile = allFiles[0];
            debugLog(`æµ‹è¯•ç¬¬ä¸€ä¸ªæ–‡ä»¶: ${firstFile.url}`);
            
            const iframe = document.getElementById('hiddenFrame');
            iframe.onload = function() {
                debugLog(`æˆåŠŸåŠ è½½æ–‡ä»¶: ${firstFile.url}`);
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    const messages = doc.querySelectorAll('.message');
                    debugLog(`æ–‡ä»¶ ${firstFile.url} åŒ…å« ${messages.length} æ¡æ¶ˆæ¯`);
                } catch (e) {
                    debugLog(`è¯»å–æ–‡ä»¶å†…å®¹æ—¶å‡ºé”™: ${e.message}`);
                }
            };
            
            iframe.onerror = function() {
                debugLog(`åŠ è½½æ–‡ä»¶å¤±è´¥: ${firstFile.url}`);
            };
            
            iframe.src = firstFile.url;
        }

        // ä½¿ç”¨iframeåŠ è½½æ–‡ä»¶å†…å®¹
        async function loadFileWithIframe(fileUrl) {
            return new Promise((resolve, reject) => {
                const iframe = document.getElementById('hiddenFrame');
                
                iframe.onload = function() {
                    try {
                        const doc = iframe.contentDocument || iframe.contentWindow.document;
                        const messages = extractMessagesFromDocument(doc);
                        resolve(messages);
                    } catch (e) {
                        debugLog(`è§£ææ–‡ä»¶ ${fileUrl} æ—¶å‡ºé”™: ${e.message}`);
                        resolve([]);
                    }
                };
                
                iframe.onerror = function() {
                    debugLog(`åŠ è½½æ–‡ä»¶å¤±è´¥: ${fileUrl}`);
                    resolve([]);
                };
                
                iframe.src = fileUrl;
            });
        }

        // ä»æ–‡æ¡£ä¸­æå–æ¶ˆæ¯
        function extractMessagesFromDocument(doc) {
            const messages = [];
            const messageElements = doc.querySelectorAll('.message');
            
            messageElements.forEach(element => {
                try {
                    const senderElement = element.querySelector('.sender-name');
                    const contentElement = element.querySelector('.message-content');
                    const timeElement = element.querySelector('.message-time');
                    
                    if (senderElement && contentElement) {
                        const message = {
                            sender: senderElement.textContent.trim(),
                            content: contentElement.textContent.trim(),
                            time: timeElement ? timeElement.textContent.trim() : '',
                            html: contentElement.innerHTML
                        };
                        
                        // æ£€æŸ¥åª’ä½“ç±»å‹
                        if (contentElement.querySelector('img')) {
                            message.hasImage = true;
                        }
                        if (contentElement.querySelector('video')) {
                            message.hasVideo = true;
                        }
                        if (contentElement.querySelector('a[href*="file"]')) {
                            message.hasFile = true;
                        }
                        
                        messages.push(message);
                    }
                } catch (e) {
                    debugLog(`æå–æ¶ˆæ¯æ—¶å‡ºé”™: ${e.message}`);
                }
            });
            
            return messages;
        }

        // æ‰§è¡Œæœç´¢
        async function performSearch() {
            if (isSearching) {
                debugLog('æœç´¢æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç¨å€™...');
                return;
            }
            
            const keyword = document.getElementById('searchInput').value.trim();
            const senderFilter = document.getElementById('senderFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            const mediaFilter = document.getElementById('mediaFilter').value;
            
            if (!keyword) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            isSearching = true;
            searchResults = [];
            
            debugLog(`å¼€å§‹æœç´¢: å…³é”®è¯="${keyword}", å‘é€è€…="${senderFilter}", å¹´ä»½="${dateFilter}", åª’ä½“="${mediaFilter}"`);
            
            // æ›´æ–°ç»Ÿè®¡
            let searchedCount = 0;
            let totalMessages = 0;
            let foundCount = 0;
            
            // è¿‡æ»¤è¦æœç´¢çš„æ–‡ä»¶
            const filesToSearch = allFiles.filter(file => {
                if (dateFilter && file.year !== dateFilter) return false;
                return true;
            });
            
            debugLog(`å‡†å¤‡æœç´¢ ${filesToSearch.length} ä¸ªæ–‡ä»¶`);
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('resultsContainer').innerHTML = '<div class="loading">æ­£åœ¨æœç´¢ä¸­ï¼Œè¯·ç¨å€™...</div>';
            
            // é€ä¸ªæœç´¢æ–‡ä»¶
            for (let i = 0; i < Math.min(filesToSearch.length, 50); i++) { // é™åˆ¶æœç´¢å‰50ä¸ªæ–‡ä»¶é¿å…è¶…æ—¶
                const file = filesToSearch[i];
                searchedCount++;
                
                document.getElementById('searchedFiles').textContent = searchedCount;
                
                debugLog(`æ­£åœ¨æœç´¢æ–‡ä»¶ ${i + 1}/${filesToSearch.length}: ${file.url}`);
                
                try {
                    const messages = await loadFileWithIframe(file.url);
                    totalMessages += messages.length;
                    
                    // æœç´¢åŒ¹é…çš„æ¶ˆæ¯
                    messages.forEach(message => {
                        if (messageMatchesFilters(message, keyword, senderFilter, mediaFilter)) {
                            foundCount++;
                            searchResults.push({
                                ...message,
                                fileUrl: file.url,
                                filename: file.filename,
                                date: file.date
                            });
                        }
                    });
                    
                    document.getElementById('totalMessages').textContent = totalMessages;
                    document.getElementById('foundResults').textContent = foundCount;
                    
                    // æ·»åŠ å»¶è¿Ÿé¿å…æµè§ˆå™¨é˜»å¡
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (e) {
                    debugLog(`æœç´¢æ–‡ä»¶ ${file.url} æ—¶å‡ºé”™: ${e.message}`);
                }
            }
            
            debugLog(`æœç´¢å®Œæˆï¼Œå…±æ‰¾åˆ° ${searchResults.length} æ¡ç»“æœ`);
            
            // æ˜¾ç¤ºç»“æœ
            displayResults();
            isSearching = false;
        }

        // æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦åŒ¹é…ç­›é€‰æ¡ä»¶
        function messageMatchesFilters(message, keyword, senderFilter, mediaFilter) {
            // å…³é”®è¯åŒ¹é…
            if (keyword && !message.content.toLowerCase().includes(keyword.toLowerCase())) {
                return false;
            }
            
            // å‘é€è€…ç­›é€‰
            if (senderFilter && !message.sender.includes(senderFilter)) {
                return false;
            }
            
            // åª’ä½“ç±»å‹ç­›é€‰
            if (mediaFilter) {
                switch (mediaFilter) {
                    case 'text':
                        if (message.hasImage || message.hasVideo || message.hasFile) return false;
                        break;
                    case 'image':
                        if (!message.hasImage) return false;
                        break;
                    case 'video':
                        if (!message.hasVideo) return false;
                        break;
                    case 'file':
                        if (!message.hasFile) return false;
                        break;
                }
            }
            
            return true;
        }

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displayResults() {
            const container = document.getElementById('resultsContainer');
            const countElement = document.getElementById('resultsCount');
            
            countElement.textContent = `å…±æ‰¾åˆ° ${searchResults.length} æ¡ç»“æœ`;
            
            if (searchResults.length === 0) {
                container.innerHTML = '<div class="no-results">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»“æœ</div>';
                return;
            }
            
            const resultsHtml = searchResults.map(result => {
                const highlightedContent = highlightKeyword(result.content, document.getElementById('searchInput').value);
                return `
                    <div class="result-item" onclick="openChatFile('${result.fileUrl}')">
                        <div class="result-header">
                            <span class="result-sender">${result.sender}</span>
                            <span class="result-time">${result.time}</span>
                        </div>
                        <div class="result-content">${highlightedContent}</div>
                        <div class="result-file">ğŸ“ ${result.filename} | ğŸ“… ${result.date}</div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = resultsHtml;
        }

        // é«˜äº®å…³é”®è¯
        function highlightKeyword(text, keyword) {
            if (!keyword) return text;
            const regex = new RegExp(`(${keyword})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // æ‰“å¼€èŠå¤©æ–‡ä»¶
        function openChatFile(fileUrl) {
            window.open(fileUrl, '_blank');
        }

        // æ¸…é™¤æœç´¢
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('senderFilter').value = '';
            document.getElementById('dateFilter').value = '';
            document.getElementById('mediaFilter').value = '';
            document.getElementById('resultsContainer').innerHTML = '<div class="no-results">è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</div>';
            document.getElementById('resultsCount').textContent = 'å…±æ‰¾åˆ° 0 æ¡ç»“æœ';
            document.getElementById('searchedFiles').textContent = '0';
            document.getElementById('totalMessages').textContent = '0';
            document.getElementById('foundResults').textContent = '0';
            searchResults = [];
            debugLog('æœç´¢å·²æ¸…é™¤');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('é¡µé¢åŠ è½½å®Œæˆ');
            
            // ç»‘å®šäº‹ä»¶
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('clearBtn').addEventListener('click', clearSearch);
            
            // å›è½¦é”®æœç´¢
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // åˆå§‹åŒ–æ–‡ä»¶åˆ—è¡¨
            initializeFileList();
        });
    </script>
</body>
</html>