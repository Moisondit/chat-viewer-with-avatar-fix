<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœç´¢åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: monospace;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” æœç´¢åŠŸèƒ½æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æœç´¢åŠŸèƒ½çš„å„ä¸ªç»„ä»¶æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        
        <div class="test-item">
            <h3>1. åŸºç¡€è¿æ¥æµ‹è¯•</h3>
            <button class="test-button" onclick="testConnection()">æµ‹è¯•æœç´¢é¡µé¢è¿æ¥</button>
            <div id="connectionResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>2. æ–‡ä»¶ç³»ç»Ÿæµ‹è¯•</h3>
            <button class="test-button" onclick="testFileSystem()">æµ‹è¯•Dataç›®å½•å’Œæ–‡ä»¶</button>
            <div id="fileSystemResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>3. JavaScriptåŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testJavaScript()">æµ‹è¯•æ ¸å¿ƒå‡½æ•°</button>
            <div id="javascriptResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>4. æœç´¢åŠŸèƒ½æµ‹è¯•</h3>
            <input type="text" id="testSearchInput" placeholder="è¾“å…¥æµ‹è¯•å…³é”®è¯" style="width: 200px; padding: 5px;">
            <button class="test-button" onclick="testSearch()">æ‰§è¡Œæœç´¢æµ‹è¯•</button>
            <div id="searchResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>5. å®Œæ•´æ€§æ£€æŸ¥</h3>
            <button class="test-button" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="fullTestResult" class="result"></div>
        </div>
    </div>

    <script>
        // æµ‹è¯•æœç´¢é¡µé¢è¿æ¥
        function testConnection() {
            const result = document.getElementById('connectionResult');
            result.innerHTML = 'æ­£åœ¨æµ‹è¯•è¿æ¥...';
            
            fetch('./search.html')
                .then(response => {
                    if (response.ok) {
                        result.innerHTML = '<span class="success">âœ… æœç´¢é¡µé¢è¿æ¥æ­£å¸¸</span>';
                    } else {
                        result.innerHTML = `<span class="error">âŒ æœç´¢é¡µé¢è¿æ¥å¤±è´¥: ${response.status}</span>`;
                    }
                })
                .catch(error => {
                    result.innerHTML = `<span class="error">âŒ è¿æ¥é”™è¯¯: ${error.message}</span>`;
                });
        }
        
        // æµ‹è¯•æ–‡ä»¶ç³»ç»Ÿ
        function testFileSystem() {
            const result = document.getElementById('fileSystemResult');
            result.innerHTML = 'æ­£åœ¨æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ...';
            
            // æ£€æŸ¥Dataç›®å½•ä¸­çš„æ–‡ä»¶
            fetch('./Data/chat_2023_01_01.html')
                .then(response => {
                    if (response.ok) {
                        result.innerHTML = '<span class="success">âœ… Dataç›®å½•å’ŒèŠå¤©æ–‡ä»¶å¯è®¿é—®</span>';
                    } else {
                        result.innerHTML = '<span class="warning">âš ï¸ Dataç›®å½•å­˜åœ¨ä½†æ–‡ä»¶å¯èƒ½ä¸å®Œæ•´</span>';
                    }
                })
                .catch(error => {
                    result.innerHTML = `<span class="error">âŒ æ–‡ä»¶ç³»ç»Ÿè®¿é—®é”™è¯¯: ${error.message}</span>`;
                });
        }
        
        // æµ‹è¯•JavaScriptåŠŸèƒ½
        function testJavaScript() {
            const result = document.getElementById('javascriptResult');
            
            // æ‰“å¼€æœç´¢é¡µé¢çª—å£è¿›è¡Œæµ‹è¯•
            const testWindow = window.open('./search.html', 'testWindow', 'width=800,height=600');
            
            setTimeout(() => {
                try {
                    if (testWindow && !testWindow.closed) {
                        // æ£€æŸ¥å…³é”®å‡½æ•°æ˜¯å¦å­˜åœ¨
                        const checks = [
                            testWindow.performSearch,
                            testWindow.loadChatFileList,
                            testWindow.searchInFile,
                            testWindow.displayResults
                        ];
                        
                        const allExists = checks.every(func => typeof func === 'function');
                        
                        if (allExists) {
                            result.innerHTML = '<span class="success">âœ… æ‰€æœ‰æ ¸å¿ƒJavaScriptå‡½æ•°æ­£å¸¸</span>';
                        } else {
                            result.innerHTML = '<span class="error">âŒ éƒ¨åˆ†JavaScriptå‡½æ•°ç¼ºå¤±</span>';
                        }
                        
                        testWindow.close();
                    } else {
                        result.innerHTML = '<span class="error">âŒ æ— æ³•æ‰“å¼€æµ‹è¯•çª—å£</span>';
                    }
                } catch (error) {
                    result.innerHTML = `<span class="error">âŒ JavaScriptæµ‹è¯•é”™è¯¯: ${error.message}</span>`;
                }
            }, 2000);
        }
        
        // æµ‹è¯•æœç´¢åŠŸèƒ½
        function testSearch() {
            const result = document.getElementById('searchResult');
            const searchTerm = document.getElementById('testSearchInput').value;
            
            if (!searchTerm) {
                result.innerHTML = '<span class="warning">âš ï¸ è¯·è¾“å…¥æœç´¢å…³é”®è¯</span>';
                return;
            }
            
            result.innerHTML = 'æ­£åœ¨æµ‹è¯•æœç´¢åŠŸèƒ½...';
            
            // æ¨¡æ‹Ÿæœç´¢è¿‡ç¨‹
            const testWindow = window.open('./search.html', 'searchTest', 'width=800,height=600');
            
            setTimeout(() => {
                try {
                    if (testWindow && !testWindow.closed) {
                        // è®¾ç½®æœç´¢å€¼å¹¶æ‰§è¡Œæœç´¢
                        const searchInput = testWindow.document.getElementById('searchInput');
                        if (searchInput) {
                            searchInput.value = searchTerm;
                            
                            // æ£€æŸ¥æ˜¯å¦æœ‰æœç´¢æŒ‰é’®
                            const searchButton = testWindow.document.getElementById('searchButton');
                            if (searchButton) {
                                searchButton.click();
                                result.innerHTML = '<span class="success">âœ… æœç´¢åŠŸèƒ½è§¦å‘æˆåŠŸ</span>';
                            } else {
                                result.innerHTML = '<span class="error">âŒ æœç´¢æŒ‰é’®æœªæ‰¾åˆ°</span>';
                            }
                        } else {
                            result.innerHTML = '<span class="error">âŒ æœç´¢è¾“å…¥æ¡†æœªæ‰¾åˆ°</span>';
                        }
                        
                        setTimeout(() => testWindow.close(), 3000);
                    }
                } catch (error) {
                    result.innerHTML = `<span class="error">âŒ æœç´¢æµ‹è¯•é”™è¯¯: ${error.message}</span>`;
                }
            }, 2000);
        }
        
        // è¿è¡Œå®Œæ•´æµ‹è¯•
        function runFullTest() {
            const result = document.getElementById('fullTestResult');
            result.innerHTML = 'æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...<br>';
            
            let testsCompleted = 0;
            const totalTests = 4;
            
            // ä¾æ¬¡è¿è¡Œæ‰€æœ‰æµ‹è¯•
            setTimeout(() => {
                testConnection();
                testsCompleted++;
                result.innerHTML += `è¿æ¥æµ‹è¯•å®Œæˆ (${testsCompleted}/${totalTests})<br>`;
            }, 500);
            
            setTimeout(() => {
                testFileSystem();
                testsCompleted++;
                result.innerHTML += `æ–‡ä»¶ç³»ç»Ÿæµ‹è¯•å®Œæˆ (${testsCompleted}/${totalTests})<br>`;
            }, 1500);
            
            setTimeout(() => {
                testJavaScript();
                testsCompleted++;
                result.innerHTML += `JavaScriptæµ‹è¯•å®Œæˆ (${testsCompleted}/${totalTests})<br>`;
            }, 3500);
            
            setTimeout(() => {
                // ä½¿ç”¨é»˜è®¤å…³é”®è¯æµ‹è¯•æœç´¢
                document.getElementById('testSearchInput').value = 'æµ‹è¯•';
                testSearch();
                testsCompleted++;
                result.innerHTML += `æœç´¢æµ‹è¯•å®Œæˆ (${testsCompleted}/${totalTests})<br>`;
                result.innerHTML += '<span class="success">âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆï¼</span>';
            }, 6000);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.onload = function() {
            setTimeout(() => {
                testConnection();
            }, 1000);
        };
    </script>
</body>
</html>